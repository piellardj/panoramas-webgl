!function(){"use strict";var e={630:function(e,t,r){var a,n=this&&this.__extends||(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(753),c=l(r(771)),h=s(r(748)),d=l(r(62)),f=r(459),v=r(61),_=function(e){function t(){var t=e.call(this,u.gl)||this;return t._vbo=d.default.createQuad(u.gl,-1,-1,1,1),t.buildShader("_shaderBoxToBox","converter.vert","converterBoxToBox.frag"),t.buildShader("_shaderBoxToPlanet","converter.vert","converterBoxToPlanet.frag"),t.buildShader("_shaderBoxToSphere","converter.vert","converterBoxToSphere.frag"),t.buildShader("_shaderSphereToBox","converter.vert","converterSphereToBox.frag"),t.buildShader("_shaderSphereToPlanet","converter.vert","converterSphereToPlanet.frag"),t.buildShader("_shaderSphereToSphere","converter.vert","converterSphereToSphere.frag"),t.buildShader("_shaderPlanetToBox","converter.vert","converterPlanetToBox.frag"),t.buildShader("_shaderPlanetToPlanet","converter.vert","converterPlanetToPlanet.frag"),t.buildShader("_shaderPlanetToSphere","converter.vert","converterPlanetToSphere.frag"),t}return n(t,e),t.prototype.freeGLResources=function(){this._vbo&&(this._vbo.freeGLResources(),this._vbo=null),this.deleteShader("_shaderBoxToBox"),this.deleteShader("_shaderBoxToPlanet"),this.deleteShader("_shaderBoxToSphere"),this.deleteShader("_shaderSphereToBox"),this.deleteShader("_shaderSphereToPlanet"),this.deleteShader("_shaderSphereToSphere"),this.deleteShader("_shaderPlanetToBox"),this.deleteShader("_shaderPlanetToPlanet"),this.deleteShader("_shaderPlanetToSphere")},t.prototype.draw=function(e){var t=this.getShader(v.Parameters.inputFormat,v.Parameters.outputFormat);t&&e&&(t.u.uTexture.value=e,t.u.uPaddingTop.value=v.Parameters.paddingTop,t.u.uPaddingBottom.value=v.Parameters.paddingBottom,t.u.uPaddingBack.value=v.Parameters.paddingBack,t.u.uRotateZ.value=v.Parameters.rotateZ,t.u.uFlipVertically.value=v.Parameters.flipVertically?-1:1,t.use(),t.bindUniformsAndAttributes(),u.gl.drawArrays(u.gl.TRIANGLE_STRIP,0,4))},t.prototype.deleteShader=function(e){this[e]&&(this[e].freeGLResources(),this[e]=null)},t.prototype.buildShader=function(e,t,r){var a=this;h.buildShader({fragmentFilename:r,vertexFilename:t},(function(t){null!==t&&(a[e]=t,a[e].a.aCorner.VBO=a._vbo)}))},t.prototype.getShader=function(e,t){return e===f.Format.Skybox?t===f.Format.Skybox?this._shaderBoxToBox:t===f.Format.Skysphere?this._shaderBoxToSphere:this._shaderBoxToPlanet:e===f.Format.Skysphere?t===f.Format.Skybox?this._shaderSphereToBox:t===f.Format.Skysphere?this._shaderSphereToSphere:this._shaderSphereToPlanet:e===f.Format.Tinyplanet?t===f.Format.Skybox?this._shaderPlanetToBox:t===f.Format.Skysphere?this._shaderPlanetToSphere:this._shaderPlanetToPlanet:void 0},t}(c.default);t.default=_},459:function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),t.FormatUtils=t.Format=void 0,function(e){e.Skybox="skybox",e.Skysphere="skysphere",e.Tinyplanet="tinyplanet"}(r||(t.Format=r={}));var a=function(){function e(){}return e.guessFormat=function(t){if(e.mayBeSkybox(t))return r.Skybox;var a=t.width/t.height;return Math.abs(a-1)<.1?r.Tinyplanet:r.Skysphere},e.parseString=function(e){return e===r.Skybox?r.Skybox:e===r.Tinyplanet?r.Tinyplanet:r.Skysphere},e.ratio=function(e){return e===r.Skybox?4/3:e===r.Skysphere?2:1},e.mayBeSkybox=function(e){var t=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});t.canvas.width=8,t.canvas.height=6,t.drawImage(e,0,0,t.canvas.width,t.canvas.height);for(var r=[{x:0,y:0},{x:5,y:0},{x:6,y:0},{x:7,y:0},{x:0,y:5},{x:5,y:5},{x:6,y:5},{x:7,y:5}],a=t.getImageData(r[0].x,r[0].y,1,1).data,n=0,o=r;n<o.length;n++)for(var i=o[n],s=t.getImageData(i.x,i.y,1,1).data,l=0;l<4;++l)if(s[l]!==a[l])return!1;return!0},e}();t.FormatUtils=a},753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(457);var a=null;t.gl=a,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var n=Page.Canvas.getCanvas();if(t.gl=a=n.getContext("webgl",e),null==a){if(t.gl=a=n.getContext("experimental-webgl",e),null==a)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.BLEND),a.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=a.canvas,n=Math.floor(r.clientWidth*t),o=Math.floor(r.clientHeight*t);r.width===n&&r.height===o||(r.width=n,r.height=o)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.default=r},206:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Mat4=void 0;var a=r(710),n=function(){function e(){this._val=new Float32Array(16),this.identity()}return Object.defineProperty(e,"tmpMatrix",{get:function(){return null===e._tmpMatrix&&(e._tmpMatrix=new e),e._tmpMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"val",{get:function(){return this._val},enumerable:!1,configurable:!0}),e.prototype.identity=function(){for(var e=0;e<16;++e)this._val[e]=0;this._val[0]=1,this._val[5]=1,this._val[10]=1,this._val[15]=1},e.prototype.lookAt=function(e,t,r){if(e.equals(t))this.identity();else{var n=a.Vec3.substract(e,t);n.normalize();var o=a.Vec3.crossProduct(r,n);o.normalize();var i=a.Vec3.crossProduct(n,o);i.normalize(),this._val[0]=o.x,this._val[1]=i.x,this._val[2]=n.x,this._val[3]=0,this._val[4]=o.y,this._val[5]=i.y,this._val[6]=n.y,this._val[7]=0,this._val[8]=o.z,this._val[9]=i.z,this._val[10]=n.z,this._val[11]=0,this._val[12]=-a.Vec3.dotProduct(o,e),this._val[13]=-a.Vec3.dotProduct(i,e),this._val[14]=-a.Vec3.dotProduct(n,e),this._val[15]=1}},e.prototype.multiplyRight=function(t){for(var r=e.tmpMatrix._val,a=this._val,n=t._val,o=0;o<4;++o)for(var i=0;i<4;++i){r[4*o+i]=0;for(var s=0;s<4;++s)r[4*o+i]+=a[4*s+i]*n[4*o+s]}this.swapWithTmpMatrix()},e.prototype.invert=function(){var t=this._val,r=t[0],a=t[1],n=t[2],o=t[3],i=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],v=t[12],_=t[13],p=t[14],g=t[15],b=r*s-a*i,m=r*l-n*i,y=r*u-o*i,P=a*l-n*s,T=a*u-o*s,x=n*u-o*l,S=c*_-h*v,O=c*p-d*v,E=c*g-f*v,M=h*p-d*_,w=h*g-f*_,R=d*g-f*p,B=b*R-m*w+y*M+P*E-T*O+x*S;if(!B)return!1;B=1/B;var A=e.tmpMatrix._val;return A[0]=(s*R-l*w+u*M)*B,A[1]=(n*w-a*R-o*M)*B,A[2]=(_*x-p*T+g*P)*B,A[3]=(d*T-h*x-f*P)*B,A[4]=(l*E-i*R-u*O)*B,A[5]=(r*R-n*E+o*O)*B,A[6]=(p*y-v*x-g*m)*B,A[7]=(c*x-d*y+f*m)*B,A[8]=(i*w-s*E+u*S)*B,A[9]=(a*E-r*w-o*S)*B,A[10]=(v*T-_*y+g*b)*B,A[11]=(h*y-c*T-f*b)*B,A[12]=(s*O-i*M-l*S)*B,A[13]=(r*M-a*O+n*S)*B,A[14]=(_*m-v*P-p*b)*B,A[15]=(c*P-h*m+d*b)*B,this.swapWithTmpMatrix(),!0},e.prototype.perspective=function(e,t,r,a){var n=1/Math.tan(e/2);if(this._val[0]=n/t,this._val[1]=0,this._val[2]=0,this._val[3]=0,this._val[4]=0,this._val[5]=n,this._val[6]=0,this._val[7]=0,this._val[8]=0,this._val[9]=0,this._val[11]=-1,this._val[12]=0,this._val[13]=0,this._val[15]=0,a===1/0)this._val[10]=-1,this._val[14]=-2*r;else{var o=1/(r-a);this._val[10]=(a+r)*o,this._val[14]=2*a*r*o}},e.prototype.perspectiveInverse=function(e,t,r,a){var n=Math.tan(e/2);if(this._val[0]=t*n,this._val[1]=0,this._val[2]=0,this._val[3]=0,this._val[4]=0,this._val[5]=n,this._val[6]=0,this._val[7]=0,this._val[8]=0,this._val[9]=0,this._val[10]=0,this._val[12]=0,this._val[13]=0,this._val[14]=-1,a===1/0)this._val[11]=-.5,this._val[15]=.5/r;else{var o=.5/(r*a);this._val[11]=(r-a)*o,this._val[15]=(r+a)*o}},e.prototype.swapWithTmpMatrix=function(){var t=e.tmpMatrix._val;e.tmpMatrix._val=this._val,this._val=t},e._tmpMatrix=null,e}();t.Mat4=n},710:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Vec3=void 0;var r=1e-4,a=function(){function e(e,t,r){this._val=new Float32Array(3),this._val[0]=e,this._val[1]=t,this._val[2]=r}return e.dotProduct=function(e,t){return e._val[0]*t._val[0]+e._val[1]*t._val[1]+e._val[2]*t._val[2]},e.crossProduct=function(t,r){return new e(t._val[1]*r._val[2]-t._val[2]*r._val[1],t._val[2]*r._val[0]-t._val[0]*r._val[2],t._val[0]*r._val[1]-t._val[1]*r._val[0])},e.substract=function(t,r){return new e(t._val[0]-r._val[0],t._val[1]-r._val[1],t._val[2]-r._val[2])},Object.defineProperty(e.prototype,"x",{get:function(){return this._val[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._val[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._val[2]},enumerable:!1,configurable:!0}),e.prototype.equals=function(e){return Math.abs(this._val[0]-e._val[0])<r&&Math.abs(this._val[1]-e._val[1])<r&&Math.abs(this._val[2]-e._val[2])<r},e.prototype.divideByScalar=function(e){this._val[0]/=e,this._val[1]/=e,this._val[2]/=e},e.prototype.substract=function(e){this._val[0]-=e._val[0],this._val[1]-=e._val[1],this._val[2]-=e._val[2]},Object.defineProperty(e.prototype,"length",{get:function(){var e=this._val[0]*this._val[0]+this._val[1]*this._val[1]+this._val[2]*this._val[2];return Math.sqrt(e)},enumerable:!1,configurable:!0}),e.prototype.normalize=function(){return Math.abs(this._val[0])<r&&Math.abs(this._val[1])<r&&Math.abs(this._val[2])<r?(this._val[0]=0,this._val[1]=0,this._val[2]=0,!1):(this.divideByScalar(this.length),!0)},e}();t.Vec3=a},748:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var s=r(753),l=i(r(490)),u=o(r(71)),c={};function h(e,t){var r=2,a=0;function n(n){if(r--,n||a++,0===r){var o=null;if(0===a){var i=u.getSource(e.vertexFilename),c=u.getSource(e.fragmentFilename);o=new l.default(s.gl,i,c)}t(o)}}u.loadSource(e.vertexFilename,n),u.loadSource(e.fragmentFilename,n)}t.getShader=function(e){return c[e].shader},t.buildShader=h,t.registerShader=function(e,t,r){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===c[e]){c[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var n=c[e];h(t,(function(e){n.pending=!1,n.failed=null===e,n.shader=e,a(n)}))}else{var o=c[e];!0===o.pending?o.callbacks.push(r):a(o)}},t.deleteShader=function(e){c[e]&&(c[e].shader&&c[e].shader.freeGLResources(),delete c[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var r={};t.loadSource=function(e,t){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===r[e]){r[e]={callbacks:[t],failed:!1,pending:!0,text:null};var n=r[e],o=new XMLHttpRequest;o.open("GET","./shaders/"+e,!0),o.onload=function(){4===o.readyState&&(n.pending=!1,200===o.status?(n.text=o.responseText,n.failed=!1):(console.error("Cannot load '"+e+"' shader source: "+o.statusText),n.failed=!0),a(n))},o.onerror=function(){console.error("Cannot load '"+e+"' shader source: "+o.statusText),n.pending=!1,n.failed=!0,a(n)},o.send(null)}else{var i=r[e];!0===i.pending?i.callbacks.push(t):a(i)}},t.getSource=function(e){return r[e].text}},490:function(e,t,r){var a,n=this&&this.__extends||(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=o(r(771));function s(e,t,r){alert("NOT IMPLEMENTED YET")}var l={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,a)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,a)}},5120:{str:"BYTE",binder:s},5121:{str:"UNSIGNED_BYTE",binder:s},5122:{str:"SHORT",binder:s},5123:{str:"UNSIGNED_SHORT",binder:s},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:s},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},u=function(e){function t(t,r,a){var n=this;function o(e,r){var a=t.createShader(e);return t.shaderSource(a,r),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(console.error(t.getShaderInfoLog(a)),t.deleteShader(a),null)}(n=e.call(this,t)||this).id=null,n.uCount=0,n.aCount=0;var i=o(t.VERTEX_SHADER,r),s=o(t.FRAGMENT_SHADER,a),l=t.createProgram();return t.attachShader(l,i),t.attachShader(l,s),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)?(n.id=l,n.introspection()):(console.error(t.getProgramInfoLog(l)),t.deleteProgram(l)),n}return n(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),a=0;Object.keys(this.u).forEach((function(e){var n=t.u[e];if(null!==n.value)if(35678===n.type||35680===n.type){var o=a;l[n.type].binder(r,n.loc,o,n.value),a++}else l[n.type].binder(r,n.loc,n.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u=[];for(var r=0;r<this.uCount;++r){var a=t.getActiveUniform(this.id,r),n=a.name;this.u[n]={loc:t.getUniformLocation(this.id,n),size:a.size,type:a.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a=[],r=0;r<this.aCount;++r){var o=t.getActiveAttrib(this.id,r),i=o.name;this.a[i]={VBO:null,loc:t.getAttribLocation(this.id,i),size:o.size,type:o.type}}},t}(i.default);t.default=u},62:function(e,t,r){var a,n=this&&this.__extends||(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r,a,n){var o=e.call(this,t)||this;return o.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.id),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),o.size=a,o.type=n,o.normalize=!1,o.stride=0,o.offset=0,o}return n(t,e),t.createQuad=function(e,r,a,n,o){return new t(e,new Float32Array([r,a,n,a,r,o,n,o]),2,e.FLOAT)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t}(o(r(771)).default);t.default=i},883:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,a){this.left=e,this.lower=t,this.width=r,this.height=a}return e.setFullCanvas=function(e){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)},e.prototype.set=function(e){e.viewport(this.lower,this.left,this.width,this.height)},e}();t.default=r},633:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(r(630)),l=r(459),u=o(r(753)),c=r(753),h=i(r(883)),d=r(61),f=i(r(194));r(457),function(){function e(){d.Parameters.paddingTop=0,d.Parameters.paddingBottom=0,d.Parameters.paddingBack=0,d.Parameters.rotateZ=0,d.Parameters.flipVertically=!1}if(Page.Canvas.showLoader(!0),d.Parameters.onImageLoadObservers.push(e),d.Parameters.image=new Image,d.Parameters.image.src="./images/skybox.jpg",d.Parameters.inputFormat=l.Format.Skybox,d.Parameters.outputFormat=l.Format.Skysphere,d.Parameters.previewOutput=!1,d.Parameters.fov=70*Math.PI/180,d.Parameters.showFrame=!1,e(),u.initGL({alpha:!1,preserveDrawingBuffer:!0})){var t=new f.default,r=new s.default,a=!1;Page.FileControl.addDownloadObserver("file-download-id",(function(){var e=d.Parameters.image.width*d.Parameters.outputPercentage,n=Math.pow(2,Math.floor(Math.log(e)*Math.LOG2E)),o=n/l.FormatUtils.ratio(d.Parameters.outputFormat),i=Page.Canvas.getCanvas();function s(){i.style.position="",i.style.width="",i.style.height="",a=!0}if(i.style.position="absolute",i.style.width=n+"px",i.style.height=o+"px",i.width=n,i.height=o,u.adjustSize(),h.default.setFullCanvas(c.gl),c.gl.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT),r.draw(t.texture),c.gl.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT),r.draw(t.texture),i.msToBlob){var f=i.msToBlob();window.navigator.msSaveBlob(f,"image.png"),s()}else i.toBlob((function(e){var t=document.createElement("a");t.download="image.png",t.href=URL.createObjectURL(e),t.click(),s()}))}));var n=new h.default(0,0,1,1);requestAnimationFrame((function e(){t.update(),(t.needToRedraw||a)&&(u.adjustSize(),h.default.setFullCanvas(c.gl),c.gl.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT),t.draw(),d.Parameters.previewOutput&&(n.width=.3*c.gl.drawingBufferWidth,n.height=n.width/l.FormatUtils.ratio(d.Parameters.outputFormat),n.set(c.gl),r.draw(t.texture)),a=!1),requestAnimationFrame(e)}))}}()},457:function(){},61:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=void 0;var a=r(459);r(457);var n=new Array;function o(){for(var e=0,t=R.onChangeObservers;e<t.length;e++)(0,t[e])()}var i,s=new Array;Page.FileControl.addUploadObserver("file-upload-id",(function(e){Page.Canvas.showLoader(!0);var t=new FileReader;t.onload=function(){R.image=new Image,R.image.src=t.result},t.readAsDataURL(e[0])}));var l,u,c=new Array,h="input-format";Page.Tabs.addObserver(h,(function(e){var t=l;l=a.FormatUtils.parseString(e[0]);for(var r=0,n=c;r<n.length;r++)(0,n[r])(t,l)}));var d,f="output-format";Page.Tabs.addObserver(f,(function(e){u=a.FormatUtils.parseString(e[0]),o()}));var v,_="output-preview-id";Page.Checkbox.addObserver(_,(function(e){d=e,o()}));var p,g="fov-range-id";Page.Range.addObserver(g,(function(e){v=Math.PI/180*e,o()}));var b,m="frame-checkbox-id";Page.Checkbox.addObserver(m,(function(e){p=e,o()}));var y,P="padding-top-range-id";Page.Range.addObserver(P,(function(e){b=e,o()}));var T,x="padding-bottom-range-id";Page.Range.addObserver(x,(function(e){y=e,o()}));var S,O="padding-back-range-id";Page.Range.addObserver(O,(function(e){T=e,o()}));var E,M="rotate-z-range-id";Page.Range.addObserver(M,(function(e){S=e,o()}));var w="flip-vertically-checkbox-id";Page.Checkbox.addObserver(w,(function(e){E=e,o()})),Page.Canvas.Observers.mouseWheel.push((function(e){R.fov+=10*e*Math.PI/180}));var R=function(){function e(){}return Object.defineProperty(e,"onChangeObservers",{get:function(){return n},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onInputFormatChangeObservers",{get:function(){return c},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onImageLoadObservers",{get:function(){return s},enumerable:!1,configurable:!0}),Object.defineProperty(e,"image",{get:function(){return i},set:function(e){var t="invalid-image";(i=e).addEventListener("load",(function(){Page.Demopage.removeErrorMessage(t);for(var e=0,r=s;e<r.length;e++)(0,r[e])(i);o()})),i.addEventListener("error",(function(){Page.Demopage.setErrorMessage(t,"The image could not be loaded."),Page.Canvas.showLoader(!1),console.error("Image could not be loaded.")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"inputFormat",{get:function(){return l},set:function(e){l=e,Page.Tabs.setValues(h,[e]),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"previewOutput",{get:function(){return d},set:function(e){d=e,Page.Checkbox.setChecked(_,e),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"outputFormat",{get:function(){return u},set:function(e){u=e,Page.Tabs.setValues(f,[e]),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"outputPercentage",{get:function(){return+Page.Tabs.getValues("output-quality")[0]/100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"fov",{get:function(){return v},set:function(e){Page.Range.setValue(g,180*e/Math.PI),v=Page.Range.getValue(g)*Math.PI/180,o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"showFrame",{get:function(){return p},set:function(e){p=e,Page.Checkbox.setChecked(m,e),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"paddingTop",{get:function(){return b},set:function(e){Page.Range.setValue(P,e),b=Page.Range.getValue(P),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"paddingBottom",{get:function(){return y},set:function(e){Page.Range.setValue(x,e),y=Page.Range.getValue(x),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"paddingBack",{get:function(){return T},set:function(e){Page.Range.setValue(O,e),T=Page.Range.getValue(O),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"rotateZ",{get:function(){return S},set:function(e){Page.Range.setValue(M,e),S=Page.Range.getValue(M),o()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"flipVertically",{get:function(){return E},set:function(e){E=e,Page.Checkbox.setChecked(w,e),o()},enumerable:!1,configurable:!0}),e}();t.Parameters=R;var B=document.createElement("style");B.type="text/css",B.innerHTML="canvas:active { cursor: grab; }",document.body.appendChild(B)},194:function(e,t,r){var a,n=this&&this.__extends||(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(753),c=l(r(771)),h=s(r(748)),d=l(r(62)),f=r(206),v=r(710),_=r(459),p=r(61);r(457);var g=function(e){function t(){var t=e.call(this,u.gl)||this;t._eyePos=new v.Vec3(0,0,0),t._vertical=new v.Vec3(0,0,1),t._tmpMatrix=new f.Mat4,t._projToWorldMatrix=new f.Mat4,t.resetThetaPhi(),t._needToReloadImage=!1,t._needToRedraw=!0;var r=function(){t._needToRedraw=!0},a=function(){r(),t.resetThetaPhi(),t._needToReloadImage=!0};return p.Parameters.onInputFormatChangeObservers.push((function(e,t){e===_.Format.Skybox||t===_.Format.Skybox?(Page.Canvas.showLoader(!0),a()):r()})),p.Parameters.onChangeObservers.push(r),Page.Canvas.Observers.canvasResize.push(r),Page.Canvas.Observers.mouseDrag.push(r),t._vbo=d.default.createQuad(u.gl,-1,-1,1,1),t.buildShader("_shaderSkysphere","viewer.vert","viewerSkysphere.frag"),t.buildShader("_shaderSkybox","viewer.vert","viewerSkybox.frag"),t.buildShader("_shaderTinyplanet","viewer.vert","viewerTinyplanet.frag"),Page.Canvas.Observers.mouseDrag.push((function(e,a){t._phi+=p.Parameters.fov*Page.Canvas.getAspectRatio()*e,t._theta-=p.Parameters.fov*a,t._theta=Math.min(Math.PI-.001,Math.max(.001,t._theta)),r()})),p.Parameters.onImageLoadObservers.push((function(e){p.Parameters.inputFormat=_.FormatUtils.guessFormat(e),a()})),t}return n(t,e),t.prototype.freeGLResources=function(){this._vbo&&(this._vbo.freeGLResources(),this._vbo=null),this._texture&&(u.gl.deleteTexture(this._texture),this._texture=null),this._shaderSkybox&&(this._shaderSkybox.freeGLResources(),this._shaderSkybox=null),this._shaderSkysphere&&(this._shaderSkysphere.freeGLResources(),this._shaderSkysphere=null),this._shaderTinyplanet&&(this._shaderTinyplanet.freeGLResources(),this._shaderTinyplanet=null)},Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"needToRedraw",{get:function(){return this._needToRedraw},enumerable:!1,configurable:!0}),t.prototype.update=function(){this._needToReloadImage&&(p.Parameters.inputFormat===_.Format.Skybox?this.splitAndLoadSkybox(p.Parameters.image):this.loadTexture(p.Parameters.image),this._needToReloadImage=!1,Page.Canvas.showLoader(!1))},t.prototype.draw=function(){var e;(e=p.Parameters.inputFormat===_.Format.Skybox?this._shaderSkybox:p.Parameters.inputFormat===_.Format.Skysphere?this._shaderSkysphere:this._shaderTinyplanet)&&this._texture&&(this.recomputeMatrices(),e.u.uProjToWorld.value=this._projToWorldMatrix.val,e.u.uTexture.value=this._texture,e.u.uPaddingTop.value=p.Parameters.paddingTop,e.u.uPaddingBottom.value=p.Parameters.paddingBottom,e.u.uPaddingBack.value=p.Parameters.paddingBack,e.u.uRotateZ.value=p.Parameters.rotateZ,e.u.uFlipVertically.value=p.Parameters.flipVertically?-1:1,e.u.uShowFrame.value=p.Parameters.showFrame?1:0,e.use(),e.bindUniformsAndAttributes(),u.gl.drawArrays(u.gl.TRIANGLE_STRIP,0,4)),this._needToRedraw=!1},t.prototype.resetThetaPhi=function(){this._theta=.5*Math.PI,this._phi=0,this._needToRedraw=!0},t.prototype.loadTexture=function(e){u.gl.deleteTexture(this._texture),this._texture=u.gl.createTexture(),u.gl.bindTexture(u.gl.TEXTURE_2D,this._texture),u.gl.texImage2D(u.gl.TEXTURE_2D,0,u.gl.RGBA,u.gl.RGBA,u.gl.UNSIGNED_BYTE,e),u.gl.texParameteri(u.gl.TEXTURE_2D,u.gl.TEXTURE_WRAP_S,u.gl.CLAMP_TO_EDGE),u.gl.texParameteri(u.gl.TEXTURE_2D,u.gl.TEXTURE_WRAP_T,u.gl.CLAMP_TO_EDGE),u.gl.texParameteri(u.gl.TEXTURE_2D,u.gl.TEXTURE_MIN_FILTER,u.gl.LINEAR),u.gl.texParameteri(u.gl.TEXTURE_2D,u.gl.TEXTURE_MAG_FILTER,u.gl.LINEAR)},t.prototype.splitAndLoadSkybox=function(e){var t,r=(t=Math.floor(Math.max(e.width/4,e.height/3)),Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)));u.gl.deleteTexture(this._texture),this._texture=u.gl.createTexture();var a=document.createElement("canvas").getContext("2d");a.canvas.width=r,a.canvas.height=r;var n=[{target:u.gl.TEXTURE_CUBE_MAP_POSITIVE_X,position:{x:2,y:1},rotation:.5*Math.PI},{target:u.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,position:{x:0,y:1},rotation:-.5*Math.PI},{target:u.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,position:{x:1,y:1},rotation:-Math.PI},{target:u.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,position:{x:3,y:1},rotation:0},{target:u.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,position:{x:1,y:0},rotation:Math.PI},{target:u.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,position:{x:1,y:2},rotation:0}];u.gl.bindTexture(u.gl.TEXTURE_CUBE_MAP,this._texture),a.translate(r,0),a.scale(-1,1);for(var o=e.width/4,i=e.height/3,s=0,l=n;s<l.length;s++){var c=l[s];a.translate(.5*r,.5*r),a.rotate(c.rotation),a.translate(-.5*r,-.5*r),a.drawImage(e,c.position.x*o,c.position.y*i,o,i,0,0,r,r),u.gl.texImage2D(c.target,0,u.gl.RGBA,u.gl.RGBA,u.gl.UNSIGNED_BYTE,a.canvas),a.translate(.5*r,.5*r),a.rotate(-c.rotation),a.translate(-.5*r,-.5*r)}u.gl.generateMipmap(u.gl.TEXTURE_CUBE_MAP),u.gl.texParameteri(u.gl.TEXTURE_CUBE_MAP,u.gl.TEXTURE_MIN_FILTER,u.gl.LINEAR_MIPMAP_LINEAR),u.gl.texParameteri(u.gl.TEXTURE_CUBE_MAP,u.gl.TEXTURE_MAG_FILTER,u.gl.LINEAR)},t.prototype.buildShader=function(e,t,r){var a=this;h.buildShader({fragmentFilename:r,vertexFilename:t},(function(t){null!==t&&(a[e]=t,a[e].a.aCorner.VBO=a._vbo,a._needToRedraw=!0)}))},t.prototype.recomputeMatrices=function(){var e=new v.Vec3(Math.sin(this._theta)*Math.cos(this._phi),Math.sin(this._theta)*Math.sin(this._phi),Math.cos(this._theta));this._projToWorldMatrix.lookAt(this._eyePos,e,this._vertical),this._projToWorldMatrix.invert();var t=u.gl.canvas,r=t.clientWidth/t.clientHeight;this._tmpMatrix.perspectiveInverse(p.Parameters.fov,r,.1,1/0),this._projToWorldMatrix.multiplyRight(this._tmpMatrix)},t}(c.default);t.default=g}},t={};!function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,r),o.exports}(633)}();
//# sourceMappingURL=main.min.js.map